{% extends 'base.html' %}

{% block title %}Geçmişim - StudyBuddy{% endblock %}

{% block content %}
<div class="history-page">
    <div class="container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb breadcrumb-gradient">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}"><i class="bi bi-house"></i> Ana Sayfa</a></li>
                <li class="breadcrumb-item active" aria-current="page"><i class="bi bi-clock-history"></i> Geçmişim</li>
            </ol>
        </nav>
        
        <!-- Header Section -->
        <div class="history-header d-flex justify-content-between align-items-center flex-wrap gap-3">
            <div>
                <h1><i class="bi bi-clock-history"></i> Döküman Geçmişim</h1>
                <p class="mb-0">Toplam <strong>{{ documents|length }}</strong> döküman işlediniz</p>
            </div>
            <a href="{{ url_for('upload') }}" class="btn btn-light">
                <i class="bi bi-plus-circle"></i> Yeni Döküman Yükle
            </a>
        </div>

        <!-- Empty State -->
        {% if documents|length == 0 %}
        <div class="empty-state">
            <i class="bi bi-inbox empty-state-icon"></i>
            <h3>Henüz hiç döküman işlemediniz</h3>
            <p>Hemen başlayın ve ilk dökümanınızı yükleyin!</p>
            <a href="{{ url_for('upload') }}" class="btn btn-primary-custom btn-lg">
                <i class="bi bi-cloud-upload"></i> Yeni Döküman Yükle
            </a>
        </div>
        {% else %}
        <!-- Document Cards -->
        <div class="row g-4">
            {% for document in documents %}
            <div class="col-md-6 col-lg-4">
                <div class="document-card">
                    <div class="document-card-header">
                        {% if document.file_type == 'pdf' %}
                            <i class="bi bi-file-pdf text-danger"></i>
                        {% elif document.file_type == 'docx' or document.file_type == 'doc' %}
                            <i class="bi bi-file-word text-primary"></i>
                        {% elif document.file_type == 'pptx' or document.file_type == 'ppt' %}
                            <i class="bi bi-file-slides text-warning"></i>
                        {% elif document.file_type == 'txt' %}
                            <i class="bi bi-file-text text-secondary"></i>
                        {% else %}
                            <i class="bi bi-file-earmark text-muted"></i>
                        {% endif %}
                        <h6 title="{{ document.original_filename }}">{{ document.original_filename }}</h6>
                    </div>
                    
                    <div class="document-card-body">
                        <!-- Badges -->
                        <div class="document-badges">
                            <!-- User Level Badge -->
                            {% if document.user_level == 'elementary' %}
                                <span class="badge bg-info">İlkokul</span>
                            {% elif document.user_level == 'middle_school' %}
                                <span class="badge bg-success">Ortaokul</span>
                            {% elif document.user_level == 'high_school' %}
                                <span class="badge bg-primary">Lise</span>
                            {% elif document.user_level == 'university' %}
                                <span class="badge bg-warning text-dark">Üniversite</span>
                            {% elif document.user_level == 'exam_prep' %}
                                <span class="badge bg-danger">Sınav Hazırlığı</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ document.user_level }}</span>
                            {% endif %}

                            <!-- User Type Badge -->
                            {% if document.user_type == 'student' %}
                                <span class="badge" style="background: var(--color-primary-gradient); color: white;">
                                    <i class="bi bi-mortarboard"></i> Öğrenci
                                </span>
                            {% else %}
                                <span class="badge" style="background: var(--color-primary-gradient); color: white;">
                                    <i class="bi bi-person-workspace"></i> Öğretmen
                                </span>
                            {% endif %}
                        </div>

                        <!-- Meta Information -->
                        <div class="document-meta">
                            <!-- File Size -->
                            <div class="document-meta-item">
                                <i class="bi bi-hdd"></i>
                                <span>
                                    {% if document.file_size < 1024 %}
                                        {{ document.file_size }} B
                                    {% elif document.file_size < 1048576 %}
                                        {{ "%.2f"|format(document.file_size / 1024) }} KB
                                    {% else %}
                                        {{ "%.2f"|format(document.file_size / 1048576) }} MB
                                    {% endif %}
                                </span>
                            </div>

                            <!-- Upload Date -->
                            <div class="document-meta-item">
                                <i class="bi bi-calendar-plus"></i>
                                <span>
                                    {% if document.created_at %}
                                        {{ document.created_at.strftime('%d %B %Y, %H:%M') }}
                                    {% else %}
                                        bilinmiyor
                                    {% endif %}
                                </span>
                            </div>

                            <!-- Last Accessed -->
                            <div class="document-meta-item">
                                <i class="bi bi-clock"></i>
                                <span>
                                    Son: {% if document.last_accessed %}{{ document.last_accessed.strftime('%d %b %H:%M') }}{% else %}bilinmiyor{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="document-card-footer">
                        {% if document.results and document.results|length > 0 %}
                            <a href="{{ url_for('view_result', result_id=document.results[0].id) }}" class="btn btn-primary-custom w-100 mb-2">
                                <i class="bi bi-eye"></i> Sonuçları Görüntüle
                            </a>
                        {% else %}
                            <button class="btn btn-secondary w-100 mb-2" disabled>
                                <i class="bi bi-exclamation-circle"></i> Sonuç Bulunamadı
                            </button>
                        {% endif %}
                        <a href="{{ url_for('upload') }}" class="btn btn-outline-custom w-100">
                            <i class="bi bi-arrow-clockwise"></i> Yeniden İşle
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
