{% extends 'base.html' %}

{% block title %}{{ _('Dashboard') }} - StudyBuddy{% endblock %}

{% block content %}
<div class="dashboard-page">
    <div class="container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb breadcrumb-light">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}"><i class="bi bi-house"></i> {{ _('Ana Sayfa') }}</a></li>
                <li class="breadcrumb-item active" aria-current="page"><i class="bi bi-bar-chart"></i> {{ _('Dashboard') }}</li>
            </ol>
        </nav>
        
        <div class="dashboard-header">
            <h1>ğŸ“Š {{ _('Dashboard') }}</h1>
            <p>{{ _('HoÅŸ geldiniz,') }} <strong>{{ user.username }}</strong>! {{ _('KullanÄ±m istatistikleriniz aÅŸaÄŸÄ±da gÃ¶rÃ¼ntÃ¼lenmektedir.') }}</p>
        </div>
        
        <div class="row g-4">
            <!-- AylÄ±k KullanÄ±m KartÄ± -->
            <div class="col-md-6 col-lg-4">
                <div class="stat-card">
                    <h3><i class="bi bi-calendar-month"></i> {{ _('Bu Ay KullanÄ±m') }}</h3>
                    
                    {% if stats and stats.limit_info %}
                    <div class="stat-value-display">
                        <span class="stat-value-large">{{ stats.limit_info.used }}</span>
                        <span class="stat-value-label">
                            {% if stats.limit_info.limit %}
                                / {{ stats.limit_info.limit }} {{ _('Dosya') }}
                            {% else %}
                                {{ _('Dosya (SÄ±nÄ±rsÄ±z)') }}
                            {% endif %}
                        </span>
                    </div>
                    
                    {% if stats.limit_info.limit %}
                    <div class="progress-container">
                        <div class="progress">
                            <div class="progress-bar" 
                                 role="progressbar" 
                                 style="width: {{ stats.limit_info.percentage }}%;"
                                 aria-valuenow="{{ stats.limit_info.used }}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="{{ stats.limit_info.limit }}">
                                {{ stats.limit_info.percentage|round(0)|int }}%
                            </div>
                        </div>
                        <div class="progress-info">
                            <span>{{ _('KullanÄ±lan:') }} {{ stats.limit_info.used }}</span>
                            <span>{{ _('Kalan:') }} {% if stats.limit_info.remaining is none %}{{ _('SÄ±nÄ±rsÄ±z') }}{% else %}{{ stats.limit_info.remaining }}{% endif %}</span>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if stats.limit_info.remaining is not none and stats.limit_info.remaining <= 0 %}
                    <div class="alert-limit">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <strong>{{ _('AylÄ±k limitiniz doldu!') }}</strong> {{ _('Premium plana geÃ§erek sÄ±nÄ±rsÄ±z yÃ¼kleme yapabilirsiniz.') }}
                        <div class="mt-2">
                            <a href="{{ url_for('pricing') }}" class="btn btn-warning btn-sm">
                                <i class="bi bi-star"></i> {{ _('Premium\'a GeÃ§') }}
                            </a>
                        </div>
                    </div>
                    {% endif %}
                    {% else %}
                    <p class="text-muted">{{ _('Ä°statistik bilgisi yÃ¼kleniyor...') }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Cache Ä°statistikleri -->
            <div class="col-md-6 col-lg-4">
                <div class="stat-card">
                    <h3><i class="bi bi-lightning-charge"></i> {{ _('Cache PerformansÄ±') }}</h3>
                    
                    {% if stats and stats.current_month %}
                    <div class="stat-value-display">
                        <span class="stat-value-large">{{ stats.current_month.cache_hits }}</span>
                        <span class="stat-value-label">{{ _('Cache Hit') }}</span>
                    </div>
                    
                    <div class="stat-item">
                        <span><i class="bi bi-piggy-bank text-warning"></i> {{ _('Token Tasarrufu') }}</span>
                        <strong>{{ stats.current_month.tokens_saved }}</strong>
                    </div>
                    
                    {% if stats.current_month.uploads > 0 %}
                    <div class="stat-item">
                        <span><i class="bi bi-percent text-info"></i> {{ _('Hit Rate') }}</span>
                        <strong>
                            {{ ((stats.current_month.cache_hits / (stats.current_month.cache_hits + stats.current_month.uploads)) * 100)|round(1) }}%
                        </strong>
                    </div>
                    {% endif %}
                    {% else %}
                    <p class="text-muted">{{ _('Ä°statistik bilgisi yÃ¼kleniyor...') }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Toplam DÃ¶kÃ¼manlar -->
            <div class="col-md-6 col-lg-4">
                <div class="stat-card">
                    <h3><i class="bi bi-file-earmark-text"></i> {{ _('Toplam Ä°ÅŸlenen') }}</h3>
                    
                    {% if stats %}
                    <div class="stat-value-display">
                        <span class="stat-value-large">{{ stats.total_documents }}</span>
                        <span class="stat-value-label">{{ _('DÃ¶kÃ¼man') }}</span>
                    </div>
                    
                    <a href="{{ url_for('history') }}" class="btn btn-outline-custom w-100">
                        <i class="bi bi-clock-history"></i> {{ _('GeÃ§miÅŸi GÃ¶rÃ¼ntÃ¼le') }}
                    </a>
                    {% else %}
                    <p class="text-muted">{{ _('Ä°statistik bilgisi yÃ¼kleniyor...') }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="stat-card">
                    <h3><i class="bi bi-lightning"></i> {{ _('HÄ±zlÄ± Ä°ÅŸlemler') }}</h3>
                    <div class="quick-actions">
                        <a href="{{ url_for('upload') }}" class="btn btn-primary-custom">
                            <i class="bi bi-cloud-upload"></i> {{ _('Yeni DÃ¶kÃ¼man YÃ¼kle') }}
                        </a>
                        <a href="{{ url_for('history') }}" class="btn btn-outline-custom">
                            <i class="bi bi-clock-history"></i> {{ _('GeÃ§miÅŸi GÃ¶rÃ¼ntÃ¼le') }}
                        </a>
                        {% if user.subscription_plan == 'free' %}
                        <a href="{{ url_for('pricing') }}" class="btn btn-primary-custom">
                            <i class="bi bi-star"></i> {{ _('PlanÄ±mÄ± YÃ¼kselt') }}
                        </a>
                        {% endif %}
                        <a href="{{ url_for('profile') }}" class="btn btn-outline-custom">
                            <i class="bi bi-person"></i> {{ _('Profilim') }}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
